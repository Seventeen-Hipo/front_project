<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>ç™»å½•é¡µé¢ - åŠ¨ç‰©ç§‘æ™®ç½‘</title>
    <!-- å¼•å…¥CSSæ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="login_style.css">
    <!-- å¼•å…¥å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* é”™è¯¯æç¤ºä½äºç™»å½•æ ‡é¢˜å‰¯æ ‡é¢˜ä¸‹æ–¹ï¼Œå±…ä¸­å±•ç¤º */
        .login-header { position: relative; }
        #errorMessage{
            position: relative;
            display: none;
            opacity: 0;
            margin: 10px auto 0 auto;
            width: 100%;
            max-width: 80%;
            text-align: center;
            background: rgba(255,77,79,0.10);
            border: 1px solid rgba(255,77,79,0.25);
            color: #ff4d4f;
            padding: 10px 12px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
            transition: opacity .2s ease;
        }
        #errorMessage.show{ opacity: 1; }
        #errorMessage p{ margin: 0; }
    </style>
</head>

<body>
    <div class="login-wrapper">
        <a href="home.html" class="back-home">â† è¿”å›é¦–é¡µ</a>
        <div class="login-container">
            <div class="login-header">
                <div class="login-icon">ğŸ”</div>
                <h2 class="login-title">è´¦å·ç™»å½•</h2>
                <p class="login-subtitle">æ¬¢è¿å›æ¥ï¼Œæ¢ç´¢åŠ¨ç‰©ä¸–ç•Œçš„å¥¥ç§˜</p>
                <div class="err" id="errorMessage">
                    <p id="errorText"></p>
                </div>
            </div>
            <!-- å…³é”®ä¿®æ”¹ï¼šè¡¨å•ä½¿ç”¨AJAXæäº¤ï¼Œé¿å…é¡µé¢åˆ·æ–° -->
            <form id="loginForm" onsubmit="handleLogin(event)">
                <!-- ç”¨æˆ·åè¾“å…¥æ¡†ï¼šæ–°å¢name="username"ï¼Œç”¨äºåç«¯æ¥æ”¶æ•°æ® -->
                <div class="form-group">
                    <i class="icon fa-solid fa-user"></i>
                    <input type="text" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <!-- å¯†ç è¾“å…¥æ¡†ï¼šæ–°å¢name="password"ï¼Œç”¨äºåç«¯æ¥æ”¶æ•°æ® -->
                <div class="form-group">
                    <i class="icon fa-solid fa-lock"></i>
                    <input type="password" name="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <!-- é€‰é¡¹ç»„ -->
                <div class="option-group">
                    <label class="remember-me">
                        <input type="checkbox" name="remember">è®°ä½æˆ‘
                    </label>
                    <a href="#" class="forgot-password">å¿˜è®°å¯†ç </a>
                </div>
                <!-- ç™»å½•æŒ‰é’® -->
                <button type="submit" class="login-btn">ç™»å½•</button>
                <!-- æ³¨å†Œé“¾æ¥ -->
                <div class="register-link">
                    è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a href="register.html">ç«‹å³æ³¨å†Œ</a>
                </div>
            </form>
        </div>
    </div>
    <script>
        // æ£€æŸ¥URLå‚æ•°ä¸­çš„é”™è¯¯ä¿¡æ¯
        const urlParams = new URLSearchParams(window.location.search);
        const error = urlParams.get('error');
        if (error) {
            showError(error);
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼ˆä¸è‡ªåŠ¨æ¶ˆå¤±ï¼Œç›´åˆ°ç”¨æˆ·æ“ä½œï¼‰
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.opacity = '1';
                errorDiv.classList.add('show');
            }, 10);
        }

        // éšè—é”™è¯¯ä¿¡æ¯
        function hideError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.style.opacity = '0';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 300);
        }

        // å¤„ç†ç™»å½•æäº¤
        async function handleLogin(event) {
            event.preventDefault();
            
            const form = document.getElementById('loginForm');
            const formData = new FormData(form);
            const loginBtn = document.querySelector('.login-btn');
            const originalText = loginBtn.textContent;
            
            // æŒ‰é’®åŠ è½½çŠ¶æ€
            loginBtn.disabled = true;
            loginBtn.textContent = 'ç™»å½•ä¸­...';
            loginBtn.style.opacity = '0.7';
            
            try {
                // å‘é€AJAXè¯·æ±‚
                const response = await fetch('/api/login', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ç™»å½•æˆåŠŸ
                    loginBtn.textContent = 'ç™»å½•æˆåŠŸï¼';
                    loginBtn.style.background = 'linear-gradient(135deg, #51cf66 0%, #69db7c 100%)';
                    
                    // å»¶è¿Ÿè·³è½¬ï¼Œæ˜¾ç¤ºæˆåŠŸçŠ¶æ€
                    setTimeout(() => {
                        window.location.href = '/home';
                    }, 800);
                } else {
                    // ç™»å½•å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯
                    showError(data.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ');
                    loginBtn.disabled = false;
                    loginBtn.textContent = originalText;
                    loginBtn.style.opacity = '1';
                }
            } catch (error) {
                console.error('ç™»å½•é”™è¯¯:', error);
                showError('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
                loginBtn.disabled = false;
                loginBtn.textContent = originalText;
                loginBtn.style.opacity = '1';
            }
        }

        // ä»…å½“ç”¨æˆ·å¼€å§‹è¾“å…¥æ—¶éšè—é”™è¯¯
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', function () {
                const errorDiv = document.getElementById('errorMessage');
                if (errorDiv && errorDiv.style.display === 'block') {
                    hideError();
                }
            });
        });
    </script>
</body>
</html>